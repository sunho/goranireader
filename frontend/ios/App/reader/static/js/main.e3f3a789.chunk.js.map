{"version":3,"sources":["fonts/lora-latin-400.woff","fonts/lora-latin-700.woff","fonts/noto-sans-kr-latin-400.woff","fonts/noto-sans-kr-latin-500.woff","fonts/noto-sans-kr-latin-700.woff","utills/event.ts","bridge.tsx","utills/hooks.ts","components/Dict/index.tsx","components/SentenceSelector/index.tsx","components/SwipeItemChildren/index.tsx","components/Reader/index.tsx","components/Quiz/index.tsx","components/Wrapper/index.tsx","index.tsx"],"names":["module","exports","LiteEvent","handlers","handler","this","push","filter","h","data","console","log","slice","forEach","Webapp","onFlushPaginate","onCancelSelect","onStartReader","onStartQuiz","window","app","DevAppImpl","IOSAppImpl","sentences","sid","trigger","questions","qid","load","word","i","sids","JSON","stringify","addable","words","pron","defs","def","id","wordIndex","resolveDict","undefined","webkit","messageHandlers","bridge","postMessage","type","Promise","res","rej","useOutsideClickObserver","ref","callback","handleClickOutside","event","current","contains","target","useEffect","document","addEventListener","removeEventListener","useLiteEventObserver","deps","handleEvent","v","on","off","DictContainer","styled","div","props","up","css","hide","DictWordComponent","DictDefsComponent","DictButtons","DictButton","enabled","Dict","useState","setRes","pos","setPos","dictRef","useRef","selectedWord","sentenceId","dictSearch","out","parse","then","str","webapp","cancelSelect","resWord","notFound","node","length","onClick","map","key","addUnknownWord","SentenceSelectorContainer","top","bottom","SentenceSelector","conRef","selectedSentence","addUnknownSentence","SentenceComponent","p","inline","selected","WordComponent","span","first","SwipeItem","setSelectedWord","setSelectedSentence","pat","touch","figureSentenceUp","parentRect","parentElement","getBoundingClientRect","myRect","figureWordUp","onTouchWord","j","k","x","y","clearTimeout","timer","setTimeout","handle","n","wordSelected","Math","floor","toString","sentence","start","content","split","s","onTouchEnd","onTouchMove","e","touches","clientX","clientY","sqrt","onTouchCancel","onTouchStart","match","Main","Swipe","ReactSwipe","loading","Reader","_dividePositions","setDividePositions","swipeItemRefs","swipeRef","idToPage","Map","readingSentence","dividePositions","getPageSentences","page","atHandle","readingPage","get","atStart","atEnd","atMiddle","readingSentenceChange","setLoading","lastItem","parentBounds","parentTop","parentHeight","height","pageTop","currentPage","cutPos","children","Array","fill","flatMap","_","sen","reduce","tuple","set","paginate","swipeOptions","startSlide","continuous","sens","getPos","old","neww","r","childCount","style","cursor","SwipeItemChildren","Quiz","readingQuestion","findIndex","o","Wrapper","state","setState","initComplete","GlobalStyle","createGlobalStyle","navigator","userAgent","setIOS","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.e3f3a789.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/lora-latin-400.0d78d370.woff\";","module.exports = __webpack_public_path__ + \"static/media/lora-latin-700.1617380e.woff\";","module.exports = __webpack_public_path__ + \"static/media/noto-sans-kr-latin-400.4c50be0f.woff\";","module.exports = __webpack_public_path__ + \"static/media/noto-sans-kr-latin-500.28601458.woff\";","module.exports = __webpack_public_path__ + \"static/media/noto-sans-kr-latin-700.b9e989a9.woff\";","interface ILiteEvent<T> {\r\n  on(handler: { (data?: T): void }) : void;\r\n  off(handler: { (data?: T): void }) : void;\r\n}\r\n\r\nexport class LiteEvent<T> implements ILiteEvent<T> {\r\n  private handlers: { (data?: T): void; }[] = [];\r\n\r\n  public on(handler: { (data?: T): void }) : void {\r\n      this.handlers.push(handler);\r\n  }\r\n\r\n  public off(handler: { (data?: T): void }) : void {\r\n      this.handlers = this.handlers.filter(h => h !== handler);\r\n  }\r\n\r\n  public trigger(data?: T) {\r\n      console.log(this.handlers);\r\n      this.handlers.slice(0).forEach(h => h(data));\r\n  }\r\n\r\n  public expose() : ILiteEvent<T> {\r\n      return this;\r\n  }\r\n}\r\n","import { Sentence, DictSearchResult, Question } from \"./model\";\r\nimport { LiteEvent } from \"./utills/event\";\r\n\r\nexport interface App {\r\n  initComplete(): void;\r\n  setLoading(loading: boolean): void;\r\n  atStart(): void;\r\n  atMiddle(): void;\r\n  atEnd(): void;\r\n  paginate(sids: string[]): void;\r\n  wordSelected(word: string, i: number, sid: string): void;\r\n  sentenceSelected(sid: string): void;\r\n  readingSentenceChange(sid: string): void;\r\n  dictSearch(word: string): string | Promise<string>;\r\n  addUnknownWord(sid: string, wordIndex: number, word: string, def: string): void;\r\n  addUnknownSentence(sid: string): void;\r\n}\r\n\r\nexport class Webapp {\r\n  readonly onFlushPaginate = new LiteEvent<void>();\r\n  readonly onCancelSelect = new LiteEvent<void>();\r\n  readonly onStartReader = new LiteEvent<{sentences: Sentence[], sid: string}>();\r\n  readonly onStartQuiz = new LiteEvent<{questions: Question[]; qid: string}>();\r\n\r\n  setDev() {\r\n    window.app = new DevAppImpl();\r\n  }\r\n\r\n  setIOS() {\r\n    window.app = new IOSAppImpl();\r\n  }\r\n\r\n  startReader(sentences: Sentence[], sid: string) {\r\n    this.onStartReader.trigger({\r\n      sentences: sentences,\r\n      sid: sid\r\n    });\r\n  }\r\n\r\n  startQuiz(questions: Question[], qid: string) {\r\n    this.onStartQuiz.trigger({questions:questions, qid: qid});\r\n  }\r\n\r\n  flushPaginate() {\r\n    this.onFlushPaginate.trigger();\r\n  }\r\n\r\n  cancelSelect() {\r\n    this.onCancelSelect.trigger();\r\n  }\r\n}\r\n\r\nclass DevAppImpl implements App {\r\n  constructor() {}\r\n\r\n  initComplete() {\r\n    console.log(\"[app] init complete\");\r\n  }\r\n\r\n  setLoading(load: boolean) {\r\n    console.log(\"[app] loading: \" + load);\r\n  }\r\n\r\n  atStart() {\r\n    console.log(\"[app] at start\");\r\n  }\r\n\r\n  atMiddle() {\r\n    console.log(\"[app] at middle\");\r\n  }\r\n\r\n  atEnd() {\r\n    console.log(\"[app] at end\");\r\n  }\r\n\r\n  wordSelected(word: string, i: number, sid: string) {\r\n    console.log(\"[app] at end i: \" + i + \" sid:\" + sid);\r\n  }\r\n\r\n  paginate(sids: string[]) {\r\n    console.log(\"[app] paginate sids\");\r\n    console.log(sids)\r\n  }\r\n\r\n  sentenceSelected(sid: string) {\r\n    console.log(\"[app] sentence selected sid:\"+ sid);\r\n  }\r\n\r\n  readingSentenceChange(sid: string) {\r\n    console.log(\"[app] reading setence changed\");\r\n  }\r\n\r\n  dictSearch(word: string): string {\r\n    const out: DictSearchResult = {\r\n      addable: false,\r\n      words: [\r\n        {\r\n          word: \"hello\",\r\n          pron: \"\",\r\n          defs: [\r\n            {\r\n              def: \"asdfasf\",\r\n              id: 1,\r\n            },\r\n            {\r\n              def: \"asdfasf\",\r\n              id: 1,\r\n            },\r\n            {\r\n              def: \"asdfasf\",\r\n              id: 1,\r\n            },\r\n            {\r\n              def: \"asdfasf\",\r\n              id: 1,\r\n            },\r\n            {\r\n              def: \"asdfasf\",\r\n              id: 1,\r\n            },\r\n            {\r\n              def: \"asdfasf\",\r\n              id: 1,\r\n            },\r\n            {\r\n              def: \"asdfasf\",\r\n              id: 1,\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          word: \"hello\",\r\n          pron: \"\",\r\n          defs: [\r\n            {\r\n              def: \"asdfasf\",\r\n              id: 1,\r\n            },\r\n            {\r\n              def: \"asdfasf\",\r\n              id: 1,\r\n            },\r\n            {\r\n              def: \"asdfasf\",\r\n              id: 1,\r\n            },\r\n            {\r\n              def: \"asdfasf\",\r\n              id: 1,\r\n            },\r\n            {\r\n              def: \"asdfasf\",\r\n              id: 1,\r\n            },\r\n            {\r\n              def: \"asdfasf\",\r\n              id: 1,\r\n            },\r\n            {\r\n              def: \"asdfasf\",\r\n              id: 1,\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n    };\r\n    return JSON.stringify(out);\r\n  }\r\n\r\n  addUnknownSentence(sid: string) {\r\n    console.log(`addUnknownSentence sid: ${sid}`);\r\n  }\r\n\r\n  addUnknownWord(sid: string, wordIndex: number, word: string, def: string) {\r\n    console.log(`addUnknownWord sid: ${sid} wordIndex: ${wordIndex} word: ${word} def: ${def}`);\r\n  }\r\n}\r\n\r\nclass IOSAppImpl implements App {\r\n  resolveDict?: (res: string) => void = undefined;\r\n  constructor() {}\r\n\r\n  initComplete() {\r\n    window.webkit.messageHandlers.bridge.postMessage({type: \"initComplete\"})\r\n  }\r\n\r\n  setLoading(load: boolean) {\r\n    window.webkit.messageHandlers.bridge.postMessage({type: \"setLoading\", load: load})\r\n  }\r\n\r\n  atStart() {\r\n    window.webkit.messageHandlers.bridge.postMessage({type: \"atStart\"})\r\n  }\r\n\r\n  atMiddle() {\r\n    window.webkit.messageHandlers.bridge.postMessage({type: \"atMiddle\"})\r\n  }\r\n\r\n  atEnd() {\r\n    window.webkit.messageHandlers.bridge.postMessage({type: \"atEnd\"})\r\n  }\r\n\r\n  wordSelected(word: string, i: number, sid: string) {\r\n    window.webkit.messageHandlers.bridge.postMessage({type: \"wordSelected\", i: i, sid: sid, word: word})\r\n  }\r\n\r\n  paginate(sids: string[]) {\r\n    window.webkit.messageHandlers.bridge.postMessage({type: \"paginate\", sids: sids})\r\n  }\r\n\r\n  sentenceSelected(sid: string) {\r\n    window.webkit.messageHandlers.bridge.postMessage({type: \"sentenceSelected\", sid: sid})\r\n  }\r\n\r\n\r\n  readingSentenceChange(sid: string) {\r\n    window.webkit.messageHandlers.bridge.postMessage({type: \"readingSentenceChange\", sid: sid})\r\n  }\r\n\r\n  dictSearch(word: string): Promise<string> {\r\n    window.webkit.messageHandlers.bridge.postMessage({type: \"dictSearch\", word: word})\r\n    return new Promise((res, rej) => {\r\n      this.resolveDict = res;\r\n    });\r\n  }\r\n\r\n  dictSearchResolve(res: string) {\r\n    if (this.resolveDict) {\r\n      this.resolveDict(res);\r\n    }\r\n  }\r\n\r\n  addUnknownSentence(sid: string) {\r\n    window.webkit.messageHandlers.bridge.postMessage({type: \"addUnknownSentence\", sid: sid})\r\n    console.log(`addUnknownSentence sid: ${sid}`);\r\n  }\r\n\r\n  addUnknownWord(sid: string, wordIndex: number, word: string, def: string) {\r\n    window.webkit.messageHandlers.bridge.postMessage({type: \"addUnknownWord\", sid: sid, wordIndex: wordIndex, word: word, def: def})\r\n  }\r\n}\r\n\r\n","import { MutableRefObject, useEffect } from \"react\";\r\nimport { LiteEvent } from \"./event\";\r\n\r\nexport function useOutsideClickObserver(\r\n  ref: MutableRefObject<HTMLElement | null | undefined>,\r\n  callback: () => void\r\n) {\r\n  function handleClickOutside(event: any) {\r\n    if (ref.current && !ref.current.contains(event.target)) {\r\n      callback();\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    document.addEventListener(\"touchstart\", handleClickOutside);\r\n    return () => {\r\n      document.removeEventListener(\"touchstart\", handleClickOutside);\r\n    };\r\n  });\r\n}\r\n\r\nexport function useLiteEventObserver<T>(\r\n  event: LiteEvent<T>,\r\n  callback: (v?: T) => void,\r\n  deps: any\r\n) {\r\n  function handleEvent(v?: T) {\r\n    callback(v)\r\n  }\r\n\r\n  useEffect(() => {\r\n    event.on(handleEvent);\r\n    return () => {\r\n      event.off(handleEvent);\r\n    }\r\n  }, deps);\r\n}\r\n","import React, { useEffect, useState, useRef } from \"react\";\r\nimport { SelectedWord, DictSearchResult, DictWord } from \"../../model\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { useOutsideClickObserver } from \"../../utills/hooks\";\r\nimport { instanceOf } from \"prop-types\";\r\n\r\nconst DictContainer = styled.div<{ up: boolean; hide: boolean }>`\r\n  position: fixed;\r\n  font-family: 'Noto Sans KR', sans-serif;\r\n  font-size: 14px;\r\n  ${props =>\r\n    props.up\r\n      ? css`\r\n          top: 10px;\r\n        `\r\n      : css`\r\n          bottom: 10px;\r\n        `}\r\n  ${props =>\r\n    props.hide &&\r\n    css`\r\n      visibility: none;\r\n    `}\r\n  background: white;\r\n  height: calc(40%);\r\n  width: calc(100% - 40px);\r\n  display: flex;\r\n  flex-direction: column;\r\n  box-shadow: 0 19px 38px rgba(0, 0, 0, 0.3), 0 15px 12px rgba(0, 0, 0, 0.22);\r\n  margin-left: 20px;\r\n  z-index: 999;\r\n`;\r\n\r\nconst DictWordComponent = styled.div`\r\n  flex-shrink: 0;\r\n  margin-bottom: 10px;\r\n  padding-top: 10px;\r\n  padding-left: 10px;\r\n  padding-right: 10px;\r\n  font-weight: 500;\r\n  font-size: 21px;\r\n`;\r\n\r\nconst DictDefsComponent = styled.div`\r\n  margin-top: 5px;\r\n  overflow-y: auto;\r\n  font-weight: 400;\r\n  & > div {\r\n    background: lightgray;\r\n    padding: 10px;\r\n    margin-bottom: 10px;\r\n    margin-left: 10px;\r\n    margin-right: 10px;\r\n    border-radius: 10px;\r\n    &:active {\r\n      background: gray;\r\n    }\r\n  }\r\n`;\r\n\r\nconst DictButtons = styled.div`\r\n  display: flex;\r\n  flex-shrink: 0;\r\n  padding-left: 10px;\r\n  padding-right: 10px;\r\n  padding-top: 10px;\r\n  justify-content: space-between;\r\n`;\r\n\r\nconst DictButton = styled.div<{ enabled: boolean }>`\r\n  padding: 7px;\r\n  background: #AB7756;\r\n  font-weight: 700;\r\n  color: white;\r\n  ${props =>\r\n    !props.enabled &&\r\n    css`\r\n      opacity: 0;\r\n      pointer-events: none;\r\n    `}\r\n`;\r\n\r\ninterface Props {\r\n  selectedWord: SelectedWord;\r\n}\r\n\r\nconst Dict: React.FC<Props> = props => {\r\n  const [res, setRes] = useState<DictSearchResult | undefined>(undefined);\r\n  const [pos, setPos] = useState(0);\r\n  const dictRef = useRef<HTMLElement | null | undefined>(undefined);\r\n  const { word, wordIndex, up, sentenceId } = props.selectedWord;\r\n\r\n  useEffect(() => {\r\n    const res = window.app.dictSearch(word);\r\n    if (typeof res === 'string') {\r\n      const out: DictSearchResult = JSON.parse(res);\r\n      setRes(out);\r\n    } else {\r\n      res.then((str) => {\r\n        const out: DictSearchResult = JSON.parse(str);\r\n        setRes(out);\r\n      })\r\n    }\r\n  }, [props]);\r\n\r\n  useOutsideClickObserver(dictRef, () => {\r\n    console.log(\"asdf\");\r\n    window.webapp.cancelSelect();\r\n  });\r\n\r\n  const result = (resWord: DictWord) => {\r\n    return (\r\n      <>\r\n        {res!.words.length !== 1 && (\r\n          <DictButtons>\r\n            <DictButton\r\n              onClick={() => {\r\n                setPos(pos - 1);\r\n              }}\r\n              enabled={pos !== 0}\r\n            >\r\n              prev\r\n            </DictButton>\r\n            <DictButton\r\n              onClick={() => {\r\n                setPos(pos + 1);\r\n              }}\r\n              enabled={pos !== res!.words.length - 1}\r\n            >\r\n              next\r\n            </DictButton>\r\n          </DictButtons>\r\n        )}\r\n        <DictWordComponent>{resWord.word}</DictWordComponent>\r\n        <DictDefsComponent>\r\n          {resWord.defs.map((def, i) => (\r\n            <div key={i} onClick={() => {\r\n              window.app.addUnknownWord(sentenceId, wordIndex, resWord.word, def.def);\r\n              window.webapp.cancelSelect();\r\n            }}>{def.def}</div>\r\n          ))}\r\n        </DictDefsComponent>\r\n      </>\r\n    );\r\n  };\r\n  const notFound = <div>Not found</div>;\r\n  return (\r\n    <DictContainer hide={!res} ref={node => (dictRef.current = node)} up={up}>\r\n      {res && res.words[pos] ? result(res.words[pos]) : notFound}\r\n    </DictContainer>\r\n  );\r\n};\r\n\r\nexport default Dict;\r\n","import React, { useRef } from \"react\";\r\nimport { SelectedSentence } from \"../../model\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { useOutsideClickObserver } from \"../../utills/hooks\";\r\n\r\nconst SentenceSelectorContainer = styled.div<{  bottom: number; top: number; up: boolean;}>`\r\n  display: flex;\r\n  position: fixed;\r\n  ${props => {\r\n    if (props.up) {\r\n      return css`\r\n        top: ${props.top - 60}px;\r\n      `;\r\n    } else {\r\n      return css`\r\n        top: ${props.bottom + 8}px;\r\n      `;\r\n    }\r\n  }}\r\n\r\n  & > div {\r\n    background: #AB7756;\r\n    padding: 8px;\r\n    margin-left: 6px;\r\n    font-family: 'Noto Sans KR', sans-serif;\r\n    font-weight: 700;\r\n    color: white;\r\n  }\r\n  z-index: 999;\r\n`;\r\n\r\ninterface Props {\r\n  selectedSentence: SelectedSentence;\r\n}\r\n\r\nconst SentenceSelector: React.FC<Props> = props => {\r\n  const conRef = useRef<HTMLElement | undefined | null>(undefined);\r\n  useOutsideClickObserver(conRef, () => {\r\n    window.webapp.cancelSelect();\r\n  });\r\n\r\n  return (\r\n    <SentenceSelectorContainer\r\n      ref={node => {\r\n        conRef.current = node;\r\n      }}\r\n      up={props.selectedSentence.up}\r\n      top={props.selectedSentence.top}\r\n      bottom={props.selectedSentence.bottom}\r\n    >\r\n      <div onClick={() => {\r\n        window.app.addUnknownSentence(props.selectedSentence.sentenceId);\r\n        window.webapp.cancelSelect();\r\n      }}>I have no idea!</div>\r\n    </SentenceSelectorContainer>\r\n  );\r\n};\r\n\r\nexport default SentenceSelector;\r\n","import React, { MutableRefObject, useRef, useState, useEffect } from \"react\";\r\nimport { Sentence, SelectedWord, SelectedSentence } from \"../../model\";\r\nimport styled, { css } from \"styled-components\";\r\nimport Dict from \"../Dict\";\r\nimport SentenceSelector from \"../SentenceSelector\";\r\n\r\nconst SentenceComponent = styled.p<{ inline: boolean; selected: boolean }>`\r\n  padding: 0;\r\n  margin: 10px 0;\r\n\r\n  ${props =>\r\n    !props.inline &&\r\n    css`\r\n      display: inline;\r\n      margin: 0;\r\n    `}\r\n  ${props =>\r\n    props.selected &&\r\n    css`\r\n      background: gray;\r\n      padding: 4px;\r\n      font-weight: 700;\r\n      color: white;\r\n    `}\r\n`;\r\n\r\nconst WordComponent = styled.span<{ selected: boolean; first: boolean }>`\r\n  display: inline;\r\n  ${props =>\r\n    props.selected &&\r\n    css`\r\n      background: gray;\r\n      font-weight: 700;\r\n      padding: 4px;\r\n      color: white;\r\n    `}\r\n  ${props =>\r\n    props.first &&\r\n    css`\r\n      margin-left: 4px;\r\n    `}\r\n`;\r\n\r\ninterface Props {\r\n  sentences: Sentence[];\r\n}\r\n\r\nconst SwipeItem: React.FC<Props> = (props: Props) => {\r\n  const [selectedWord, setSelectedWord] = useState<SelectedWord | undefined>(undefined);\r\n  const [selectedSentence, setSelectedSentence] = useState<SelectedSentence | undefined>(\r\n    undefined\r\n  );\r\n  const pat = /([^a-zA-Z-']+)/;\r\n  const touch: MutableRefObject<\r\n    { id: string; n: number; timer: number; x: number; y: number } | undefined\r\n  > = useRef(undefined);\r\n  const figureSentenceUp = (word: HTMLElement) => {\r\n    const parentRect = word.parentElement!.parentElement!.getBoundingClientRect();\r\n    const myRect = word.parentElement!.getBoundingClientRect();\r\n    return (parentRect.top - myRect.top) ** 2 > (myRect.bottom - parentRect.bottom) ** 2\r\n  }\r\n  const figureWordUp = (word: HTMLElement) => {\r\n    const parentRect = word.parentElement!.parentElement!.getBoundingClientRect();\r\n    const myRect = word.getBoundingClientRect();\r\n    return (parentRect.top - myRect.top) ** 2 > (myRect.bottom - parentRect.bottom) ** 2\r\n  }\r\n  const onTouchWord = (node: HTMLElement, j: number, k: number, word: string, x: number, y: number) => {\r\n    const id = `${j}-${k}`;\r\n    if (touch.current) {\r\n      setSelectedWord(undefined);\r\n      setSelectedSentence(undefined);\r\n      clearTimeout(touch.current.timer);\r\n      touch.current = undefined;\r\n    }\r\n    const handle = () => {\r\n      if (!touch.current) return;\r\n      if (touch.current.n === 1) {\r\n        setSelectedWord({\r\n          id: `${j}-${k}`,\r\n          word: word,\r\n          sentenceId: sentences[j].id,\r\n          wordIndex: k/2,\r\n          up: figureWordUp(node)\r\n        });\r\n        window.app.wordSelected(word, Math.floor(k / 2), sentences[j].id);\r\n        setSelectedSentence(undefined);\r\n        touch.current.n = 2;\r\n        touch.current.timer = setTimeout(() => {\r\n          handle();\r\n        }, 800);\r\n      } else if (touch.current.n === 2) {\r\n        setSelectedWord(undefined);\r\n        setSelectedSentence({\r\n          id: j.toString(),\r\n          sentenceId: sentences[j].id,\r\n          top: node.parentElement!.getBoundingClientRect().top,\r\n          bottom: node.parentElement!.getBoundingClientRect().bottom,\r\n          up: figureSentenceUp(node)\r\n        });\r\n        touch.current = undefined;\r\n      }\r\n    };\r\n    const timer = setTimeout(() => {\r\n      handle();\r\n    }, 300);\r\n    touch.current = {\r\n      n: 1,\r\n      timer: timer,\r\n      id: id,\r\n      x: x,\r\n      y: y\r\n    };\r\n  };\r\n\r\n  useEffect(() => {\r\n    let handler: any;\r\n    if (selectedWord) {\r\n      handler = () => {\r\n        setSelectedWord(undefined);\r\n      };\r\n    } else if (selectedSentence) {\r\n      handler = () => {\r\n        setSelectedSentence(undefined);\r\n      };\r\n    }\r\n\r\n    if (handler) {\r\n      window.webapp.onCancelSelect.on(handler);\r\n    }\r\n    return () => {\r\n      if (handler) {\r\n        window.webapp.onCancelSelect.off(handler);\r\n      }\r\n    };\r\n  }, [selectedSentence, selectedWord]);\r\n\r\n  const { sentences } = props;\r\n\r\n  return (\r\n    <>\r\n      {\r\n        selectedWord &&\r\n        <Dict selectedWord={selectedWord}></Dict>\r\n      }\r\n      {\r\n        selectedSentence &&\r\n        <SentenceSelector selectedSentence={selectedSentence}></SentenceSelector>\r\n      }\r\n      {sentences.map((sentence, j) => (\r\n        <SentenceComponent\r\n          selected={selectedSentence ? selectedSentence.id === j.toString() : false}\r\n          inline={!sentence.start}\r\n          key={j}\r\n        >\r\n          {sentence.content.split(pat).filter(s => s.length !== 0).map((word: string, k: number) => (\r\n            <WordComponent\r\n              selected={ selectedWord ? selectedWord.id === `${j}-${k}` : false}\r\n              first={k===0}\r\n              key={k}\r\n              onTouchEnd={() => {\r\n                if (touch.current) {\r\n                  clearTimeout(touch.current.timer);\r\n                }\r\n              }}\r\n              onTouchMove={(e) => {\r\n                if (e.touches.length !== 1) {\r\n                  return;\r\n                }\r\n                const x = e.touches[0].clientX;\r\n                const y = e.touches[0].clientY;\r\n                if (touch.current && Math.sqrt((x-touch.current.x)**2 + (y-touch.current.y) ** 2) > 30) {\r\n                  clearTimeout(touch.current.timer);\r\n                }\r\n              }}\r\n              onTouchCancel={(e) => {\r\n                if (touch.current) {\r\n                  clearTimeout(touch.current.timer);\r\n                }\r\n              }}\r\n              onTouchStart={\r\n                !word.match(pat)\r\n                  ? (e) => {\r\n                      if (e.touches.length !== 1) {\r\n                        if (touch.current) {\r\n                          clearTimeout(touch.current.timer);\r\n                        }\r\n                        return;\r\n                      }\r\n                      onTouchWord(e.target as HTMLElement, j, k, word, e.touches[0].clientX, e.touches[0].clientY);\r\n                    }\r\n                  : undefined\r\n              }\r\n            >\r\n              {word}\r\n            </WordComponent>\r\n          ))}\r\n        </SentenceComponent>\r\n      ))}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default SwipeItem;\r\n","import React, { useState, useEffect, useRef, MutableRefObject } from \"react\";\r\nimport ReactSwipe from \"react-swipe\";\r\nimport {\r\n  useOutsideClickObserver,\r\n  useLiteEventObserver\r\n} from \"../../utills/hooks\";\r\nimport SwipeItemChildren from \"../SwipeItemChildren\";\r\nimport { Sentence } from \"../../model\";\r\nimport styled, { css } from \"styled-components\";\r\n\r\nconst Main = styled.div`\r\n  height: calc(100vh - 20px);\r\n  padding: 10px 5px;\r\n  width: calc(100% - 10px);\r\n`;\r\n\r\nconst SwipeItem = styled.div`\r\n  max-height: 100%;\r\n  height: 100%;\r\n  overflow: hidden;\r\n`;\r\n\r\nconst Swipe = styled(ReactSwipe)<{ loading: boolean }>`\r\n  overflow: hidden;\r\n  height: 100%;\r\n  width: 100%;\r\n  & > div {\r\n    height: 100%;\r\n  }\r\n\r\n  & > * > div {\r\n    height: 100%;\r\n  }\r\n\r\n  ${props =>\r\n    props.loading &&\r\n    css`\r\n      opacity: 0;\r\n      pointer-events: none;\r\n    `}\r\n`;\r\n\r\ninterface Props {\r\n  sentences: Sentence[];\r\n  readingSentence: string;\r\n}\r\n\r\n// thanks to  https://github.com/yoo2001818\r\nconst Reader: React.FC<Props> = (props: Props) => {\r\n  const sentences = props.sentences;\r\n  const [_dividePositions, setDividePositions]: [any, any] = useState<number[]|null>(null);\r\n  const swipeItemRefs: any = useRef([]);\r\n\r\n  const swipeRef: MutableRefObject<ReactSwipe | null> = useRef(null);\r\n  const idToPage = useRef(new Map());\r\n  const readingSentence: MutableRefObject<string> = useRef(\r\n    props.readingSentence\r\n  );\r\n\r\n  const dividePositions = _dividePositions || [];\r\n\r\n  const getPageSentences = (page: number) => {\r\n    if (page === dividePositions.length) {\r\n      return sentences.slice(dividePositions[page - 1] || 0);\r\n    }\r\n    return sentences.slice(\r\n      dividePositions[page - 1] || 0,\r\n      dividePositions[page]\r\n    );\r\n  };\r\n\r\n  const atHandle = () => {\r\n    const readingPage = idToPage.current.get(readingSentence.current) || 0;\r\n    if (readingPage === 0) {\r\n      window.app.atStart();\r\n    }\r\n    if (readingPage === dividePositions.length) {\r\n      window.app.atEnd();\r\n    }\r\n    if (readingPage !== 0 && readingPage !== dividePositions.length) {\r\n      window.app.atMiddle();\r\n    }\r\n    window.app.readingSentenceChange(readingSentence.current);\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (_dividePositions) {\r\n      window.app.setLoading(false);\r\n      atHandle();\r\n    }\r\n  });\r\n\r\n  useEffect(() => {\r\n    // 마지막 페이지의 자를 노드 위치 계산\r\n    const lastItem = swipeItemRefs.current[0];\r\n    const parentBounds = lastItem.getBoundingClientRect();\r\n    const parentTop = parentBounds.top;\r\n    const parentHeight = parentBounds.height;\r\n    let pageTop = parentTop;\r\n    let currentPage = 0;\r\n    let cutPos: any = [];\r\n    // HTMLElement.children은 놀랍게도 배열이 아니라서 findIndex같은걸 못써요 ㅠㅠ\r\n    for (let i = 0; i < lastItem.children.length; i += 1) {\r\n      const childNode = lastItem.children[i]!;\r\n      const childBounds = childNode.getBoundingClientRect()!;\r\n      const offset = childBounds.bottom - pageTop + 20;\r\n      if (offset >= parentHeight) {\r\n        pageTop = (lastItem.children[i - 1] || lastItem.children[i]).getBoundingClientRect().bottom;\r\n        // 노드 위치는 dividePositions의 마지막 값만큼 뒤로 가있기 때문에 앞으로 다시\r\n        // 밀어주는 작업이 필요함\r\n        cutPos[currentPage] = i;\r\n        currentPage += 1;\r\n      }\r\n    }\r\n    const getPageSentencesByCutPos = (page: number) => {\r\n      if (page === cutPos.length) {\r\n        return sentences.slice(cutPos[page - 1] || 0);\r\n      }\r\n      return sentences.slice(\r\n        cutPos[page - 1] || 0,\r\n        cutPos[page]\r\n      );\r\n    };\r\n    readingSentence.current = props.readingSentence;\r\n    idToPage.current = Array(cutPos.length + 1)\r\n        .fill(1)\r\n        .flatMap((_: any, i: number) =>\r\n          getPageSentencesByCutPos(i).map(sen => [sen.id, i])\r\n        )\r\n        .reduce((map: Map<string, number>, tuple: any) => {\r\n          map.set(tuple[0], tuple[1]);\r\n          return map;\r\n        }, new Map());\r\n    setDividePositions(cutPos);\r\n  }, []);\r\n\r\n  useLiteEventObserver(\r\n    window.webapp.onFlushPaginate,\r\n    () => {\r\n      const current = idToPage.current.get(readingSentence.current) || 0;\r\n      window.app.paginate(getPageSentences(current).map(s => s.id));\r\n    },\r\n    []\r\n  );\r\n\r\n  const swipeOptions = {\r\n    startSlide: idToPage.current.get(readingSentence.current) || 0,\r\n    continuous: false,\r\n    callback: () => {\r\n      if (swipeRef.current) {\r\n        const sens = getPageSentences(swipeRef.current.getPos());\r\n        const old = idToPage.current.get(readingSentence.current) || 0;\r\n        const neww = idToPage.current.get(sens[0].id) || 0;\r\n        readingSentence.current = sens[0].id;\r\n        if (neww > old) {\r\n          window.app.paginate(getPageSentences(old).map(s => s.id));\r\n        }\r\n        window.webapp.cancelSelect();\r\n        atHandle();\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Main>\r\n      <Swipe\r\n        loading={!_dividePositions}\r\n        swipeOptions={swipeOptions}\r\n        ref={r => (swipeRef.current = r)}\r\n        childCount={dividePositions.length + 1}\r\n      >\r\n        {Array(dividePositions.length + 1)\r\n          .fill(1)\r\n          .map((_: any, i: number) => (\r\n            <SwipeItem\r\n              style={{cursor: 'pointer'}}\r\n              key={i}\r\n              ref={node => {\r\n                swipeItemRefs.current[i] = node;\r\n              }}\r\n            >\r\n              <SwipeItemChildren sentences={getPageSentences(i)} />\r\n            </SwipeItem>\r\n          ))}\r\n      </Swipe>\r\n    </Main>\r\n  );\r\n};\r\n\r\nexport default Reader;\r\n","import React, { useState, useEffect, useRef, MutableRefObject } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { Question } from \"../../model\";\r\n\r\nconst Main = styled.div`\r\n  height: calc(100vh - 20px);\r\n  padding: 10px 5px;\r\n  width: calc(100% - 10px);\r\n`;\r\n\r\ninterface Props {\r\n  questions: Question[];\r\n  readingQuestion: string;\r\n}\r\n\r\nconst Quiz: React.FC<Props> = (props: Props) => {\r\n  const { questions, readingQuestion } = props;\r\n  const i = questions.findIndex(o => o.id === readingQuestion) || 0;\r\n\r\n  return (\r\n    <Main>\r\n    </Main>\r\n  );\r\n};\r\n\r\nexport default Quiz;\r\n","import { useLiteEventObserver } from \"../../utills/hooks\";\r\nimport { useState, useEffect } from \"react\";\r\nimport React from \"react\";\r\nimport Reader from \"../Reader\";\r\nimport { Sentence, Question } from \"../../model\";\r\nimport Quiz from \"../Quiz\";\r\n\r\ninterface QuizState {\r\n  type: 'quiz';\r\n  qid: string;\r\n  questions: Question[];\r\n}\r\n\r\ninterface ReaderState {\r\n  type: 'reader';\r\n  sid: string;\r\n  sentences: Sentence[];\r\n}\r\n\r\ntype State = QuizState | ReaderState;\r\n\r\nconst Wrapper: React.SFC = () => {\r\n  const [state, setState] = useState<State | null>(null);\r\n  useLiteEventObserver(\r\n    window.webapp.onStartReader,\r\n    (event: any) => {\r\n      setState(null);\r\n      setState({\r\n        type: 'reader',\r\n        sentences: event.sentences,\r\n        sid: event.sid\r\n      });\r\n    },\r\n    []\r\n  );\r\n  useEffect(() => {\r\n    window.app.initComplete();\r\n    if (process.env.NODE_ENV === \"development\") {\r\n      const data = Array(100)\r\n        .fill(1)\r\n        .map((x, y) => x + y)\r\n        .map(id => ({\r\n          id: id.toString(),\r\n          content:\r\n            \" \\\"afdasf asdf safasdf,, safasd! (sadf asdfasf, sadf) asdfsa fsadf sadf sadfasfsadf sad fasdf adsf asdf asdf safsd afsa fsfasd fasf sad\",\r\n          start: false\r\n        }));\r\n      // window.webapp.startReader(data, \"50\");\r\n      window.webapp.startQuiz([{\r\n        type: 'word',\r\n        sentence: 'hello world',\r\n        wordIndex: 1,\r\n        options: ['hihi', 'hoho'],\r\n        answer: 0,\r\n        id: '1'\r\n      }], '')\r\n    }\r\n  }, []);\r\n  let out = <></>;\r\n  if (state) {\r\n    if (state.type === 'reader') {\r\n      out = <Reader sentences={state.sentences} readingSentence={state.sid} />;\r\n    }\r\n    if (state.type === 'quiz') {\r\n      out = <Quiz questions={state.questions} readingQuestion={state.qid} />;\r\n    }\r\n  }\r\n  return out;\r\n};\r\n\r\nexport default Wrapper;\r\n","import \"react-app-polyfill/stable\";\r\nimport \"./index.css\";\r\nimport \"./fonts/lora-latin-400.woff\"\r\nimport \"./fonts/lora-latin-700.woff\"\r\nimport \"./fonts/noto-sans-kr-latin-400.woff\"\r\nimport \"./fonts/noto-sans-kr-latin-500.woff\"\r\nimport \"./fonts/noto-sans-kr-latin-700.woff\"\r\n\r\nimport { Webapp } from \"./bridge\";\r\nimport React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport Wrapper from \"./components/Wrapper\";\r\nimport styled, { createGlobalStyle } from \"styled-components\";\r\n\r\nconst GlobalStyle = createGlobalStyle`\r\n  body {\r\n    margin: 0;\r\n    font-family: 'Lora', serif;\r\n    -webkit-font-smoothing: antialiased;\r\n    -moz-osx-font-smoothing: grayscale;\r\n    font-size: 21px;\r\n    user-select: none;\r\n    -moz-user-select: none;\r\n    -khtml-user-select: none;\r\n    -webkit-user-select: none;\r\n    -o-user-select: none;\r\n  }\r\n`;\r\n\r\nwindow.webapp = new Webapp();\r\nif (process.env.NODE_ENV === \"development\") {\r\n  window.webapp.setDev();\r\n}\r\nif (navigator.userAgent === \"ios\") {\r\n  window.webapp.setIOS();\r\n}\r\n\r\nReactDOM.render(\r\n  <div>\r\n    <GlobalStyle/>\r\n    <Wrapper/>\r\n  </div>,\r\n  document.getElementById(\"root\")\r\n);\r\n"],"sourceRoot":""}