(window.webpackJsonpreader=window.webpackJsonpreader||[]).push([[0],{156:function(e,n,t){e.exports=t(381)},369:function(e,n,t){},381:function(e,n,t){"use strict";t.r(n);var i=t(10),o=(t(157),t(369),t(51)),a=t(52),r=function(){function e(){Object(o.a)(this,e),this.handlers=[]}return Object(a.a)(e,[{key:"on",value:function(e){this.handlers.push(e)}},{key:"off",value:function(e){this.handlers=this.handlers.filter(function(n){return n!==e})}},{key:"trigger",value:function(e){console.log(this.handlers),this.handlers.slice(0).forEach(function(n){return n(e)})}},{key:"expose",value:function(){return this}}]),e}(),c=function(){function e(){Object(o.a)(this,e),this.onFlushPaginate=new r,this.onCancelSelect=new r,this.onStart=new r}return Object(a.a)(e,[{key:"setDev",value:function(){window.app=new u}},{key:"setIOS",value:function(){window.app=new d}},{key:"start",value:function(e,n){this.onStart.trigger({sentences:e,sid:n})}},{key:"flushPaginate",value:function(){this.onFlushPaginate.trigger()}},{key:"cancelSelect",value:function(){this.onCancelSelect.trigger()}}]),e}(),u=function(){function e(){Object(o.a)(this,e)}return Object(a.a)(e,[{key:"initComplete",value:function(){console.log("[app] init complete")}},{key:"setLoading",value:function(e){console.log("[app] loading: "+e)}},{key:"atStart",value:function(){console.log("[app] at start")}},{key:"atMiddle",value:function(){console.log("[app] at middle")}},{key:"atEnd",value:function(){console.log("[app] at end")}},{key:"wordSelected",value:function(e,n){console.log("[app] at end i: "+e+" sid:"+n)}},{key:"paginate",value:function(e){console.log("[app] paginate sids"),console.log(e)}},{key:"sentenceSelected",value:function(e){console.log("[app] sentence selected sid:"+e)}},{key:"readingSentenceChange",value:function(e){console.log("[app] reading setence changed")}},{key:"dictSearch",value:function(e){return JSON.stringify({addable:!1,words:[{word:"hello",pron:"",defs:[{def:"asdfasf",id:1},{def:"asdfasf",id:1},{def:"asdfasf",id:1},{def:"asdfasf",id:1},{def:"asdfasf",id:1},{def:"asdfasf",id:1},{def:"asdfasf",id:1}]},{word:"hello",pron:"",defs:[{def:"asdfasf",id:1},{def:"asdfasf",id:1},{def:"asdfasf",id:1},{def:"asdfasf",id:1},{def:"asdfasf",id:1},{def:"asdfasf",id:1},{def:"asdfasf",id:1}]}]})}},{key:"addUnknownSentence",value:function(e){console.log("addUnknownSentence sid: ".concat(e))}},{key:"addUnknownWord",value:function(e,n,t,i){console.log("addUnknownWord sid: ".concat(e," wordIndex: ").concat(n," word: ").concat(t," def: ").concat(i))}}]),e}(),d=function(){function e(){Object(o.a)(this,e),this.resolveDict=void 0}return Object(a.a)(e,[{key:"initComplete",value:function(){window.webkit.messageHandlers.bridge.postMessage({type:"initComplete"})}},{key:"setLoading",value:function(e){window.webkit.messageHandlers.bridge.postMessage({type:"setLoading",load:e})}},{key:"atStart",value:function(){window.webkit.messageHandlers.bridge.postMessage({type:"atStart"})}},{key:"atMiddle",value:function(){window.webkit.messageHandlers.bridge.postMessage({type:"atMiddle"})}},{key:"atEnd",value:function(){window.webkit.messageHandlers.bridge.postMessage({type:"atEnd"})}},{key:"wordSelected",value:function(e,n){window.webkit.messageHandlers.bridge.postMessage({type:"wordSelected",i:e,sid:n})}},{key:"paginate",value:function(e){window.webkit.messageHandlers.bridge.postMessage({type:"paginate",sids:e})}},{key:"sentenceSelected",value:function(e){window.webkit.messageHandlers.bridge.postMessage({type:"sentenceSelected",sid:e})}},{key:"readingSentenceChange",value:function(e){window.webkit.messageHandlers.bridge.postMessage({type:"readingSentenceChange",sid:e})}},{key:"dictSearch",value:function(e){var n=this;return window.webkit.messageHandlers.bridge.postMessage({type:"dictSearch",word:e}),new Promise(function(e,t){n.resolveDict=e})}},{key:"dictSearchResolve",value:function(e){this.resolveDict&&this.resolveDict(e)}},{key:"addUnknownSentence",value:function(e){window.webkit.messageHandlers.bridge.postMessage({type:"addUnknownSentence",sid:e}),console.log("addUnknownSentence sid: ".concat(e))}},{key:"addUnknownWord",value:function(e,n,t,i){window.webkit.messageHandlers.bridge.postMessage({type:"addUnknownWord",sid:e,wordIndex:n,word:t,def:i})}}]),e}(),s=t(1),l=t.n(s),f=t(150),p=t.n(f),g=t(31);function w(e,n){function t(t){e.current&&!e.current.contains(t.target)&&n()}Object(s.useEffect)(function(){return document.addEventListener("mousedown",t),function(){document.removeEventListener("mousedown",t)}})}function b(e,n,t){function i(e){n(e)}Object(s.useEffect)(function(){return e.on(i),function(){e.off(i)}},t)}var v=t(151),m=t.n(v),h=t(11);function k(){var e=Object(i.a)(["\n      opacity: 0;\n      pointer-events: none;\n    "]);return k=function(){return e},e}function y(){var e=Object(i.a)(["\n  padding: 7px;\n  background: gray;\n  color: white;\n  ","\n"]);return y=function(){return e},e}function O(){var e=Object(i.a)(["\n  display: flex;\n  flex-shrink: 0;\n  padding-left: 10px;\n  padding-right: 10px;\n  padding-top: 10px;\n  justify-content: space-between;\n"]);return O=function(){return e},e}function j(){var e=Object(i.a)(["\n  margin-top: 5px;\n  overflow-y: auto;\n  & > div {\n    background: lightgray;\n    padding: 10px;\n    margin-bottom: 10px;\n    margin-left: 10px;\n    margin-right: 10px;\n    border-radius: 10px;\n    &:active {\n      background: gray;\n    }\n  }\n"]);return j=function(){return e},e}function S(){var e=Object(i.a)(["\n  flex-shrink: 0;\n  margin-bottom: 15px;\n  padding-top: 15px;\n  padding-left: 10px;\n  padding-right: 10px;\n  font-weight: 500;\n  font-size: 15pt;\n"]);return S=function(){return e},e}function x(){var e=Object(i.a)(["\n      visibility: none;\n    "]);return x=function(){return e},e}function E(){var e=Object(i.a)(["\n          bottom: 10px;\n        "]);return E=function(){return e},e}function C(){var e=Object(i.a)(["\n          top: 10px;\n        "]);return C=function(){return e},e}function M(){var e=Object(i.a)(["\n  position: fixed;\n  ","\n  ","\n  background: white;\n  height: calc(40%);\n  width: calc(100% - 40px);\n  display: flex;\n  flex-direction: column;\n  box-shadow: 0 19px 38px rgba(0, 0, 0, 0.3), 0 15px 12px rgba(0, 0, 0, 0.22);\n  margin-left: 20px;\n  z-index: 999;\n"]);return M=function(){return e},e}var R=h.c.div(M(),function(e){return e.up?Object(h.b)(C()):Object(h.b)(E())},function(e){return e.hide&&Object(h.b)(x())}),H=h.c.div(S()),I=h.c.div(j()),U=h.c.div(O()),B=h.c.div(y(),function(e){return!e.enabled&&Object(h.b)(k())}),F=function(e){var n=Object(s.useState)(void 0),t=Object(g.a)(n,2),i=t[0],o=t[1],a=Object(s.useState)(0),r=Object(g.a)(a,2),c=r[0],u=r[1],d=Object(s.useRef)(void 0),f=e.selectedWord,p=f.word,b=f.wordIndex,v=f.up,m=f.sentenceId;Object(s.useEffect)(function(){var e=window.app.dictSearch(p);if("string"===typeof e){var n=JSON.parse(e);o(n)}else e.then(function(e){var n=JSON.parse(e);o(n)})},[e]),w(d,function(){window.webapp.cancelSelect()});var h,k=l.a.createElement("div",null,"Not found");return l.a.createElement(R,{hide:!i,ref:function(e){return d.current=e},up:v},i&&i.words[c]?(h=i.words[c],l.a.createElement(l.a.Fragment,null,1!==i.words.length&&l.a.createElement(U,null,l.a.createElement(B,{onClick:function(){u(c-1)},enabled:0!==c},"prev"),l.a.createElement(B,{onClick:function(){u(c+1)},enabled:c!==i.words.length-1},"next")),l.a.createElement(H,null,h.word),l.a.createElement(I,null,h.defs.map(function(e,n){return l.a.createElement("div",{key:n,onClick:function(){window.app.addUnknownWord(m,b,h.word,e.def),window.webapp.cancelSelect()}},e.def)})))):k)};function W(){var e=Object(i.a)(["\n        top: ","px;\n      "]);return W=function(){return e},e}function D(){var e=Object(i.a)(["\n        top: ","px;\n      "]);return D=function(){return e},e}function L(){var e=Object(i.a)(["\n  display: flex;\n  position: fixed;\n  ","\n\n  & > div {\n    background: gray;\n    color: white;\n  }\n  z-index: 999;\n"]);return L=function(){return e},e}var N=h.c.div(L(),function(e){return e.up?Object(h.b)(D(),e.top-36):Object(h.b)(W(),e.bottom)}),P=function(e){var n=Object(s.useRef)(void 0);return w(n,function(){window.webapp.cancelSelect()}),l.a.createElement(N,{ref:function(e){n.current=e},up:e.selectedSentence.up,top:e.selectedSentence.top,bottom:e.selectedSentence.bottom},l.a.createElement("div",{onClick:function(){window.app.addUnknownSentence(e.selectedSentence.sentenceId),window.webapp.cancelSelect()}},"I have no idea!"))};function J(){var e=Object(i.a)(["\n      background: red;\n    "]);return J=function(){return e},e}function z(){var e=Object(i.a)(["\n  ","\n"]);return z=function(){return e},e}function A(){var e=Object(i.a)(["\n      background: black;\n    "]);return A=function(){return e},e}function T(){var e=Object(i.a)(["\n      display: inline;\n      margin: 0;\n    "]);return T=function(){return e},e}function q(){var e=Object(i.a)(["\n  padding: 0;\n  margin: 10px 0;\n\n  ","\n  ","\n"]);return q=function(){return e},e}var G=h.c.p(q(),function(e){return!e.inline&&Object(h.b)(T())},function(e){return e.selected&&Object(h.b)(A())}),K=h.c.span(z(),function(e){return e.selected&&Object(h.b)(J())}),Q=function(e){var n=Object(s.useState)(void 0),t=Object(g.a)(n,2),i=t[0],o=t[1],a=Object(s.useState)(void 0),r=Object(g.a)(a,2),c=r[0],u=r[1],d=/([\s!,":;.?\u201c\u201d()\u2014]+)/,f=Object(s.useRef)(void 0),p=function(e){var n=e.parentElement.parentElement.getBoundingClientRect(),t=e.parentElement.getBoundingClientRect();return Math.pow(n.top-t.top,2)>Math.pow(t.bottom-n.bottom,2)},w=function(e){var n=e.parentElement.parentElement.getBoundingClientRect(),t=e.getBoundingClientRect();return Math.pow(n.top-t.top,2)>Math.pow(t.bottom-n.bottom,2)};Object(s.useEffect)(function(){var e;return i?e=function(){o(void 0)}:c&&(e=function(){u(void 0)}),e&&window.webapp.onCancelSelect.on(e),function(){e&&window.webapp.onCancelSelect.off(e)}},[c,i]);var b=e.sentences;return l.a.createElement(l.a.Fragment,null,i&&l.a.createElement(F,{selectedWord:i}),c&&l.a.createElement(P,{selectedSentence:c}),b.map(function(e,n){return l.a.createElement(G,{selected:!!c&&c.id===n.toString(),inline:!e.start,key:n},e.content.split(d).map(function(e,t){return l.a.createElement(K,{selected:!!i&&i.id==="".concat(n,"-").concat(t),key:t,onClick:e.match(d)?void 0:function(i){!function(e,n,t,i){var a="".concat(n,"-").concat(t),r=setTimeout(function(){f.current=void 0},300);f.current&&f.current.id===a?(clearTimeout(f.current.timer),f.current.timer=r,f.current.n++):f.current={id:a,timer:r,n:1},2===f.current.n?(o({id:"".concat(n,"-").concat(t),word:i,sentenceId:b[n].id,wordIndex:t/2,up:w(e)}),window.app.wordSelected(Math.floor(t/2),b[n].id),u(void 0)):3===f.current.n?(o(void 0),u({id:n.toString(),sentenceId:b[n].id,top:e.parentElement.getBoundingClientRect().top,bottom:e.parentElement.getBoundingClientRect().bottom,up:p(e)}),window.app.sentenceSelected(b[n].id)):(o(void 0),u(void 0))}(i.target,n,t,e)}},e)}))}))};function V(){var e=Object(i.a)(["\n      opacity: 0;\n      pointer-events: none;\n    "]);return V=function(){return e},e}function X(){var e=Object(i.a)(["\n  overflow: hidden;\n  height: 100%;\n  width: 100%;\n  & > div {\n    height: 100%;\n  }\n\n  & > * > div {\n    height: 100%;\n  }\n\n  ","\n"]);return X=function(){return e},e}function Y(){var e=Object(i.a)(["\n  max-height: 100%;\n  height: 100%;\n  overflow: hidden;\n"]);return Y=function(){return e},e}function Z(){var e=Object(i.a)(["\n  height: calc(100vh - 20px);\n  padding: 10px 0;\n  width: 100%;\n"]);return Z=function(){return e},e}var $=h.c.div(Z()),_=h.c.div(Y()),ee=Object(h.c)(m.a)(X(),function(e){return e.loading&&Object(h.b)(V())}),ne=function(e){var n=e.sentences,t=Object(s.useState)(null),i=Object(g.a)(t,2),o=i[0],a=i[1],r=Object(s.useRef)([]),c=Object(s.useRef)(null),u=Object(s.useRef)(new Map),d=Object(s.useRef)(e.readingSentence),f=o||[],p=function(e){return e===f.length?n.slice(f[e-1]||0):n.slice(f[e-1]||0,f[e])},w=function(){var e=u.current.get(d.current)||0;0===e&&window.app.atStart(),e===f.length&&window.app.atEnd(),0!==e&&e!==f.length&&window.app.atMiddle(),window.app.readingSentenceChange(d.current)};Object(s.useEffect)(function(){o&&(window.app.setLoading(!1),w())}),Object(s.useEffect)(function(){for(var t=r.current[0],i=t.getBoundingClientRect(),o=i.top,c=i.height,s=o,l=0,f=[],p=0;p<t.children.length;p+=1){t.children[p].getBoundingClientRect().bottom-s>=c&&(s=t.children[p-1].getBoundingClientRect().bottom,f[l]=p+0,l+=1)}d.current=e.readingSentence,u.current=Array(f.length+1).fill(1).flatMap(function(e,t){return(i=t,i===f.length?n.slice(f[i-1]||0):n.slice(f[i-1]||0,f[i])).map(function(e){return[e.id,t]});var i}).reduce(function(e,n){return e.set(n[0],n[1]),e},new Map),a(f)},[]),b(window.webapp.onFlushPaginate,function(){var e=u.current.get(d.current)||0;window.app.paginate(p(e).map(function(e){return e.id}))},[]);var v={startSlide:u.current.get(d.current)||0,continuous:!1,callback:function(){if(c.current){var e=p(c.current.getPos()),n=u.current.get(d.current)||0,t=u.current.get(e[0].id)||0;d.current=e[0].id,t>n&&window.app.paginate(p(n).map(function(e){return e.id})),window.webapp.cancelSelect(),w()}}};return l.a.createElement($,null,l.a.createElement(ee,{loading:!o,swipeOptions:v,ref:function(e){return c.current=e},childCount:f.length+1},Array(f.length+1).fill(1).map(function(e,n){return l.a.createElement(_,{key:n,ref:function(e){r.current[n]=e}},l.a.createElement(Q,{sentences:p(n)}))})))},te=function(){var e=Object(s.useState)(null),n=Object(g.a)(e,2),t=n[0],i=n[1];return b(window.webapp.onStart,function(e){i(null),i({sentences:e.sentences,sid:e.sid})},[i]),Object(s.useEffect)(function(){window.app.initComplete()},[]),l.a.createElement(l.a.Fragment,null,t&&l.a.createElement(ne,{sentences:t.sentences,readingSentence:t.sid}))};function ie(){var e=Object(i.a)(["\n  body {\n    margin: 0;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',\n      'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',\n      sans-serif;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n  }\n\n  code {\n    font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',\n      monospace;\n  }\n"]);return ie=function(){return e},e}var oe=Object(h.a)(ie());window.webapp=new c,"ios"==navigator.userAgent&&window.webapp.setIOS(),p.a.render(l.a.createElement("div",null,l.a.createElement(oe,null),l.a.createElement(te,null)),document.getElementById("root"))}},[[156,1,2]]]);
//# sourceMappingURL=main.8ef4005b.chunk.js.map